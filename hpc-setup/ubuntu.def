Bootstrap: docker
From: ubuntu:20.04

%runscript
    echo "Invoked inside the container in runtime. NO ACTIONS"    
    
%environment
    export PATH=$PATH:/Software/omnetpp-5.7/bin
    export SUMO_HOME=/Software/sumo-1.8.0

%post
    #!/bin/bash
    
    echo "Invoked inside the container in buildtime\n"
    apt-get update
    echo ""
    
    ln -fs /usr/share/zoneinfo/Europe/Berlin /etc/localtime
    export DEBIAN_FRONTEND=noninteractive
    apt-get install -y tzdata
    dpkg-reconfigure --frontend noninteractive tzdata
    
    echo "Installing git...\n"
    apt-get -y install git
    echo ""
    
    if [ ! -d /MasterThesis/.git ]
    then
        echo "Cloning repository...\n"        
        git clone https://DmitryMI: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@github.com/DmitryMI/MasterThesis
    echo ""
    else
        echo "Singularity repository already exists in $(pwd). Pulling..."
        cd /MasterThesis
        git pull
    fi

    echo "Running installation scripts...\n"
    cd /MasterThesis/software-installation
    ./install_all.sh setvars_runtime.sh
    echo ""
    
    apt-get -y autoremove
    apt-get -y clean
    apt-get -y autoclean

    sed -i '/path_new/d' /etc/environment
        
    . /etc/environment
    
    echo $PATH
    echo $SUMO_HOME
    
    # Building 
    cd /MasterThesis/drones_veins_project
    . ./setenv
    ./configure
    mkdir veins/bin
    make -j8
    
